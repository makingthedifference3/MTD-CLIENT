-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.activity_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  action character varying CHECK (action::text = ANY (ARRAY['INSERT'::character varying, 'UPDATE'::character varying, 'DELETE'::character varying, 'LOGIN'::character varying, 'LOGOUT'::character varying]::text[])),
  action_type character varying CHECK (action_type::text = ANY (ARRAY['create'::character varying, 'edit'::character varying, 'delete'::character varying, 'view'::character varying, 'approve'::character varying, 'reject'::character varying]::text[])),
  entity_type character varying,
  entity_id uuid,
  entity_name character varying,
  project_id uuid,
  old_values jsonb DEFAULT '{}'::jsonb,
  new_values jsonb DEFAULT '{}'::jsonb,
  changed_fields ARRAY,
  description text,
  ip_address character varying,
  user_agent text,
  location character varying,
  device_info jsonb DEFAULT '{}'::jsonb,
  session_id character varying,
  request_id character varying,
  duration_ms integer DEFAULT 0,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT activity_logs_pkey PRIMARY KEY (id),
  CONSTRAINT activity_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT activity_logs_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id)
);
CREATE TABLE public.bills (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  bill_code character varying NOT NULL UNIQUE,
  project_id uuid,
  expense_id uuid,
  bill_overview text,
  bill_type character varying CHECK (bill_type::text = ANY (ARRAY['Invoice'::character varying, 'Receipt'::character varying, 'Estimate'::character varying]::text[])),
  bill_number character varying,
  vendor_name character varying,
  vendor_gstin character varying,
  date date,
  due_date date,
  subtotal numeric DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  total_amount numeric DEFAULT 0,
  amount_paid numeric DEFAULT 0,
  balance_amount numeric DEFAULT 0,
  status character varying CHECK (status::text = ANY (ARRAY['pending'::character varying, 'approved'::character varying, 'paid'::character varying]::text[])),
  bill_drive_link character varying,
  payment_terms text,
  payment_method character varying,
  payment_reference character varying,
  submitted_by uuid,
  approved_by uuid,
  paid_by uuid,
  notes text,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  CONSTRAINT bills_pkey PRIMARY KEY (id),
  CONSTRAINT bills_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT bills_expense_id_fkey FOREIGN KEY (expense_id) REFERENCES public.project_expenses(id),
  CONSTRAINT bills_submitted_by_fkey FOREIGN KEY (submitted_by) REFERENCES public.users(id),
  CONSTRAINT bills_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT bills_paid_by_fkey FOREIGN KEY (paid_by) REFERENCES public.users(id),
  CONSTRAINT bills_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.budget_allocation (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid NOT NULL,
  category_id uuid NOT NULL,
  category_name character varying,
  allocated_amount numeric DEFAULT 0,
  utilized_amount numeric DEFAULT 0,
  pending_amount numeric DEFAULT 0,
  available_amount numeric DEFAULT 0,
  fiscal_year character varying,
  quarter character varying,
  month character varying,
  notes text,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT budget_allocation_pkey PRIMARY KEY (id),
  CONSTRAINT budget_allocation_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT budget_allocation_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.expense_categories(id)
);
CREATE TABLE public.budget_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid NOT NULL,
  parent_id uuid,
  name character varying NOT NULL,
  allocated_amount numeric DEFAULT 0 CHECK (allocated_amount >= 0::numeric),
  utilized_amount numeric DEFAULT 0 CHECK (utilized_amount >= 0::numeric),
  pending_amount numeric DEFAULT 0 CHECK (pending_amount >= 0::numeric),
  available_amount numeric DEFAULT ((allocated_amount - utilized_amount) - pending_amount),
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT budget_categories_pkey PRIMARY KEY (id),
  CONSTRAINT budget_categories_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT budget_categories_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.budget_categories(id),
  CONSTRAINT budget_categories_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT budget_categories_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.budget_utilization (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  csr_partner_id uuid NOT NULL,
  project_id uuid,
  fiscal_year character varying,
  quarter character varying,
  month character varying,
  allocated_amount numeric DEFAULT 0,
  utilized_amount numeric DEFAULT 0,
  committed_amount numeric DEFAULT 0,
  pending_amount numeric DEFAULT 0,
  available_amount numeric DEFAULT 0,
  utilization_percentage numeric DEFAULT 0,
  date date,
  description text,
  notes text,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT budget_utilization_pkey PRIMARY KEY (id),
  CONSTRAINT budget_utilization_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id),
  CONSTRAINT budget_utilization_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT budget_utilization_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT budget_utilization_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.calendar_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  event_code character varying NOT NULL UNIQUE,
  project_id uuid,
  task_id uuid,
  title character varying NOT NULL,
  description text,
  event_type character varying CHECK (event_type::text = ANY (ARRAY['Meeting'::character varying, 'Training'::character varying, 'Workshop'::character varying, 'Review'::character varying, 'Field Visit'::character varying]::text[])),
  category character varying,
  event_date date NOT NULL,
  start_time time without time zone,
  end_time time without time zone,
  duration_minutes integer DEFAULT 0,
  is_all_day boolean DEFAULT false,
  location character varying,
  venue character varying,
  meeting_link character varying,
  latitude numeric,
  longitude numeric,
  organizer_id uuid NOT NULL,
  assigned_to ARRAY,
  participants jsonb DEFAULT '{}'::jsonb,
  expected_attendees integer DEFAULT 0,
  actual_attendees integer DEFAULT 0,
  is_recurring boolean DEFAULT false,
  recurrence_pattern character varying,
  recurrence_end_date date,
  reminders jsonb DEFAULT '{}'::jsonb,
  status character varying CHECK (status::text = ANY (ARRAY['scheduled'::character varying, 'ongoing'::character varying, 'completed'::character varying, 'cancelled'::character varying]::text[])),
  action_items jsonb DEFAULT '{}'::jsonb,
  documents jsonb DEFAULT '{}'::jsonb,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT calendar_events_pkey PRIMARY KEY (id),
  CONSTRAINT calendar_events_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT calendar_events_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.tasks(id),
  CONSTRAINT calendar_events_organizer_id_fkey FOREIGN KEY (organizer_id) REFERENCES public.users(id),
  CONSTRAINT calendar_events_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT calendar_events_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.campaign_question_papers (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  paper_code character varying NOT NULL UNIQUE,
  project_id_old text,
  campaign_type character varying CHECK (campaign_type::text = ANY (ARRAY['pre'::character varying::text, 'post'::character varying::text])),
  title character varying NOT NULL,
  description text,
  upload_drive_link character varying,
  upload_file_name character varying,
  upload_file_size_mb numeric DEFAULT 0,
  questions jsonb DEFAULT '[]'::jsonb,
  total_questions integer DEFAULT 0,
  total_marks numeric DEFAULT 0,
  extraction_status character varying CHECK (extraction_status::text = ANY (ARRAY['pending'::character varying::text, 'processing'::character varying::text, 'completed'::character varying::text, 'failed'::character varying::text])),
  extraction_error text,
  is_verified boolean DEFAULT false,
  verified_by uuid,
  verified_at timestamp with time zone,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  project_id uuid,
  csr_partner_id uuid,
  CONSTRAINT campaign_question_papers_pkey PRIMARY KEY (id),
  CONSTRAINT campaign_question_papers_verified_by_fkey FOREIGN KEY (verified_by) REFERENCES public.users(id),
  CONSTRAINT campaign_question_papers_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT campaign_question_papers_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT campaign_question_papers_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT campaign_question_papers_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id)
);
CREATE TABLE public.campaign_results (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  result_code character varying NOT NULL UNIQUE,
  project_id_old text,
  student_name character varying NOT NULL,
  student_roll_number character varying,
  pre_answer_sheet_id uuid,
  post_answer_sheet_id uuid,
  pre_score numeric DEFAULT 0,
  pre_percentage numeric DEFAULT 0,
  pre_grade character varying,
  post_score numeric DEFAULT 0,
  post_percentage numeric DEFAULT 0,
  post_grade character varying,
  improvement_points numeric DEFAULT 0,
  improvement_percentage numeric DEFAULT 0,
  status character varying CHECK (status::text = ANY (ARRAY['improved'::character varying::text, 'declined'::character varying::text, 'same'::character varying::text, 'incomplete'::character varying::text])),
  questions_improved integer DEFAULT 0,
  questions_declined integer DEFAULT 0,
  detailed_comparison jsonb DEFAULT '[]'::jsonb,
  recommendations text,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  project_id uuid,
  csr_partner_id uuid,
  CONSTRAINT campaign_results_pkey PRIMARY KEY (id),
  CONSTRAINT campaign_results_pre_answer_sheet_id_fkey FOREIGN KEY (pre_answer_sheet_id) REFERENCES public.student_answer_sheets(id),
  CONSTRAINT campaign_results_post_answer_sheet_id_fkey FOREIGN KEY (post_answer_sheet_id) REFERENCES public.student_answer_sheets(id),
  CONSTRAINT campaign_results_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT campaign_results_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT campaign_results_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT campaign_results_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id)
);
CREATE TABLE public.communications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  task_id uuid,
  event_id uuid,
  communication_type character varying CHECK (communication_type::text = ANY (ARRAY['email'::character varying, 'whatsapp'::character varying, 'phone'::character varying, 'meeting'::character varying, 'system'::character varying]::text[])),
  from_user_id uuid NOT NULL,
  to_user_id uuid,
  subject character varying,
  message text,
  call_duration_minutes integer DEFAULT 0,
  call_outcome character varying,
  attendees ARRAY,
  attachments jsonb DEFAULT '{}'::jsonb,
  status character varying CHECK (status::text = ANY (ARRAY['sent'::character varying, 'delivered'::character varying, 'read'::character varying, 'replied'::character varying, 'failed'::character varying]::text[])),
  sent_at timestamp with time zone,
  delivered_at timestamp with time zone,
  read_at timestamp with time zone,
  is_internal boolean DEFAULT true,
  priority character varying,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  CONSTRAINT communications_pkey PRIMARY KEY (id),
  CONSTRAINT communications_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT communications_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.tasks(id),
  CONSTRAINT communications_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.calendar_events(id),
  CONSTRAINT communications_from_user_id_fkey FOREIGN KEY (from_user_id) REFERENCES public.users(id),
  CONSTRAINT communications_to_user_id_fkey FOREIGN KEY (to_user_id) REFERENCES public.users(id),
  CONSTRAINT communications_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.csr_partner_tolls (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  csr_partner_id uuid NOT NULL,
  poc_name character varying NOT NULL,
  contact_number character varying,
  email_id character varying,
  city character varying,
  state character varying,
  budget_allocation numeric DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  toll_name text,
  poc_password character varying,
  CONSTRAINT csr_partner_tolls_pkey PRIMARY KEY (id),
  CONSTRAINT csr_partner_tolls_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id),
  CONSTRAINT csr_partner_tolls_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT csr_partner_tolls_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.csr_partners (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  company_name character varying,
  registration_number character varying,
  pan_number character varying UNIQUE,
  gst_number character varying,
  contact_person character varying,
  designation character varying,
  email character varying,
  phone character varying,
  alternate_phone character varying,
  address text,
  city character varying,
  state character varying,
  pincode character varying,
  website character varying,
  logo_drive_link character varying,
  mou_drive_link character varying,
  budget_allocated numeric DEFAULT 0,
  budget_utilized numeric DEFAULT 0,
  budget_pending numeric DEFAULT 0,
  fiscal_year character varying,
  agreement_start_date date,
  agreement_end_date date,
  payment_terms text,
  billing_cycle character varying,
  bank_details jsonb DEFAULT '{}'::jsonb,
  contact_details jsonb DEFAULT '{}'::jsonb,
  documents jsonb DEFAULT '{}'::jsonb,
  is_active boolean DEFAULT true,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  primary_color character varying,
  has_toll boolean NOT NULL DEFAULT false,
  poc_password character varying,
  CONSTRAINT csr_partners_pkey PRIMARY KEY (id),
  CONSTRAINT csr_partners_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT csr_partners_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.daily_reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  report_code character varying NOT NULL UNIQUE,
  project_id uuid NOT NULL,
  user_id uuid NOT NULL,
  date date NOT NULL,
  day_of_week character varying,
  work_summary text,
  activities ARRAY,
  locations_visited ARRAY,
  tasks_completed integer DEFAULT 0,
  tasks_pending integer DEFAULT 0,
  tasks_started integer DEFAULT 0,
  task_details jsonb DEFAULT '{}'::jsonb,
  start_time time without time zone,
  end_time time without time zone,
  photos jsonb DEFAULT '{}'::jsonb,
  videos jsonb DEFAULT '{}'::jsonb,
  documents jsonb DEFAULT '{}'::jsonb,
  notes text,
  submitted_at timestamp with time zone,
  approved_by uuid,
  approved_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT daily_reports_pkey PRIMARY KEY (id),
  CONSTRAINT daily_reports_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT daily_reports_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT daily_reports_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id)
);
CREATE TABLE public.data_entry_forms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  form_code character varying NOT NULL UNIQUE,
  project_id uuid NOT NULL,
  form_name character varying,
  form_type character varying CHECK (form_type::text = ANY (ARRAY['Survey'::character varying, 'Assessment'::character varying, 'Feedback'::character varying, 'Registration'::character varying]::text[])),
  template_id character varying,
  date date NOT NULL,
  location character varying,
  school_name character varying,
  institution_name character varying,
  pre_form_data jsonb DEFAULT '{}'::jsonb,
  post_form_data jsonb DEFAULT '{}'::jsonb,
  responses jsonb DEFAULT '{}'::jsonb,
  respondent_name character varying,
  respondent_type character varying,
  respondent_count integer DEFAULT 0,
  filled_form_drive_link character varying,
  scanned_form_drive_link character varying,
  submitted_by uuid,
  verified_by uuid,
  status character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'submitted'::character varying, 'verified'::character varying]::text[])),
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  CONSTRAINT data_entry_forms_pkey PRIMARY KEY (id),
  CONSTRAINT data_entry_forms_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT data_entry_forms_submitted_by_fkey FOREIGN KEY (submitted_by) REFERENCES public.users(id),
  CONSTRAINT data_entry_forms_verified_by_fkey FOREIGN KEY (verified_by) REFERENCES public.users(id),
  CONSTRAINT data_entry_forms_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.email_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  subject character varying,
  body text,
  category character varying,
  variables jsonb DEFAULT '{}'::jsonb,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT email_templates_pkey PRIMARY KEY (id)
);
CREATE TABLE public.event_attendance (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  event_id uuid NOT NULL,
  user_id uuid NOT NULL,
  status character varying CHECK (status::text = ANY (ARRAY['invited'::character varying, 'accepted'::character varying, 'declined'::character varying, 'attended'::character varying, 'absent'::character varying]::text[])),
  response_date date,
  check_in_time timestamp with time zone,
  check_out_time timestamp with time zone,
  notes text,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT event_attendance_pkey PRIMARY KEY (id),
  CONSTRAINT event_attendance_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.calendar_events(id),
  CONSTRAINT event_attendance_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.expense_approvals (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  expense_id uuid NOT NULL,
  approver_id uuid NOT NULL,
  action character varying CHECK (action::text = ANY (ARRAY['submitted'::character varying, 'approved'::character varying, 'rejected'::character varying, 'requested_changes'::character varying]::text[])),
  previous_status character varying,
  new_status character varying,
  comments text,
  attachments jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT expense_approvals_pkey PRIMARY KEY (id),
  CONSTRAINT expense_approvals_expense_id_fkey FOREIGN KEY (expense_id) REFERENCES public.project_expenses(id),
  CONSTRAINT expense_approvals_approver_id_fkey FOREIGN KEY (approver_id) REFERENCES public.users(id)
);
CREATE TABLE public.expense_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  code character varying NOT NULL UNIQUE,
  parent_category_id uuid,
  description text,
  budget_limit numeric DEFAULT 0,
  requires_approval boolean DEFAULT true,
  approval_limit numeric DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT expense_categories_pkey PRIMARY KEY (id),
  CONSTRAINT expense_categories_parent_category_id_fkey FOREIGN KEY (parent_category_id) REFERENCES public.expense_categories(id)
);
CREATE TABLE public.media_articles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  media_code character varying NOT NULL UNIQUE,
  project_id uuid NOT NULL,
  task_id uuid,
  update_id uuid,
  title character varying NOT NULL,
  description text,
  media_type character varying CHECK (media_type::text = ANY (ARRAY['photo'::character varying, 'video'::character varying, 'document'::character varying, 'pdf'::character varying, 'newspaper_cutting'::character varying, 'certificate'::character varying, 'report'::character varying]::text[])),
  category character varying,
  sub_category character varying,
  drive_link character varying,
  drive_folder_link character varying,
  thumbnail_link character varying,
  file_name character varying,
  file_size_mb numeric DEFAULT 0,
  file_format character varying,
  resolution character varying,
  duration_seconds integer DEFAULT 0,
  is_geo_tagged boolean DEFAULT false,
  latitude numeric,
  longitude numeric,
  captured_at timestamp with time zone,
  camera_details character varying,
  news_channel character varying,
  publication_name character varying,
  publication_date date,
  reporter_name character varying,
  article_url character varying,
  date date,
  event_date date,
  location character varying,
  tags ARRAY,
  keywords ARRAY,
  is_public boolean DEFAULT true,
  is_downloadable boolean DEFAULT true,
  access_level character varying CHECK (access_level::text = ANY (ARRAY['public'::character varying, 'client'::character varying, 'internal'::character varying, 'restricted'::character varying]::text[])),
  uploaded_by uuid,
  approved_by uuid,
  approval_date date,
  views_count integer DEFAULT 0,
  downloads_count integer DEFAULT 0,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  csr_parter_id uuid,
  toll_id uuid,
  is_article boolean DEFAULT true,
  file_url text,
  CONSTRAINT media_articles_pkey PRIMARY KEY (id),
  CONSTRAINT media_articles_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT media_articles_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.tasks(id),
  CONSTRAINT media_articles_update_id_fkey FOREIGN KEY (update_id) REFERENCES public.real_time_updates(id),
  CONSTRAINT media_articles_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(id),
  CONSTRAINT media_articles_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT media_articles_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT media_articles_csr_parter_id_fkey FOREIGN KEY (csr_parter_id) REFERENCES public.csr_partners(id),
  CONSTRAINT media_articles_toll_id_fkey FOREIGN KEY (toll_id) REFERENCES public.csr_partner_tolls(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  title character varying,
  message text,
  notification_type character varying CHECK (notification_type::text = ANY (ARRAY['task'::character varying, 'expense'::character varying, 'project'::character varying, 'system'::character varying, 'alert'::character varying]::text[])),
  category character varying,
  priority character varying,
  reference_type character varying,
  reference_id uuid,
  project_id uuid,
  action_url character varying,
  action_text character varying,
  requires_action boolean DEFAULT false,
  channels ARRAY,
  is_read boolean DEFAULT false,
  read_at timestamp with time zone,
  is_seen boolean DEFAULT false,
  seen_at timestamp with time zone,
  scheduled_for timestamp with time zone,
  sent_at timestamp with time zone,
  expires_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT notifications_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT notifications_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id)
);
CREATE TABLE public.project_activities (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  activity_code character varying,
  project_id uuid NOT NULL,
  csr_partner_id uuid NOT NULL,
  toll_id uuid,
  title character varying NOT NULL,
  description text,
  section character varying DEFAULT 'General'::character varying,
  section_order integer DEFAULT 1,
  activity_order integer DEFAULT 1,
  start_date date,
  end_date date,
  actual_start_date date,
  actual_end_date date,
  status character varying DEFAULT 'not_started'::character varying CHECK (status::text = ANY (ARRAY['not_started'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'on_hold'::character varying, 'cancelled'::character varying]::text[])),
  completion_percentage integer DEFAULT 0 CHECK (completion_percentage >= 0 AND completion_percentage <= 100),
  assigned_to uuid,
  responsible_person character varying,
  priority character varying DEFAULT 'medium'::character varying CHECK (priority::text = ANY (ARRAY['low'::character varying, 'medium'::character varying, 'high'::character varying, 'critical'::character varying]::text[])),
  remarks text,
  blockers text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  created_by uuid,
  updated_by uuid,
  CONSTRAINT project_activities_pkey PRIMARY KEY (id),
  CONSTRAINT project_activities_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT project_activities_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id),
  CONSTRAINT project_activities_toll_id_fkey FOREIGN KEY (toll_id) REFERENCES public.csr_partner_tolls(id),
  CONSTRAINT project_activities_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id),
  CONSTRAINT project_activities_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT project_activities_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.project_activity_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  activity_id uuid NOT NULL,
  item_text text NOT NULL,
  item_order integer DEFAULT 1,
  is_completed boolean DEFAULT false,
  completed_at timestamp with time zone,
  completed_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT project_activity_items_pkey PRIMARY KEY (id),
  CONSTRAINT project_activity_items_activity_id_fkey FOREIGN KEY (activity_id) REFERENCES public.project_activities(id),
  CONSTRAINT project_activity_items_completed_by_fkey FOREIGN KEY (completed_by) REFERENCES public.users(id)
);
CREATE TABLE public.project_expenses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  expense_code character varying NOT NULL UNIQUE,
  project_id uuid NOT NULL,
  category_id uuid NOT NULL,
  task_id uuid,
  merchant_name character varying,
  merchant_contact character varying,
  merchant_address text,
  merchant_gstin character varying,
  merchant_pan character varying,
  date date NOT NULL,
  category character varying,
  sub_category character varying,
  description text,
  purpose text,
  base_amount numeric DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  gst_percentage numeric DEFAULT 0,
  cgst_amount numeric DEFAULT 0,
  sgst_amount numeric DEFAULT 0,
  igst_amount numeric DEFAULT 0,
  other_charges numeric DEFAULT 0,
  discount_amount numeric DEFAULT 0,
  total_amount numeric NOT NULL,
  payment_method character varying CHECK (payment_method::text = ANY (ARRAY['Cash'::character varying, 'Cheque'::character varying, 'Online'::character varying, 'Card'::character varying]::text[])),
  payment_reference character varying,
  payment_date date,
  paid_to character varying,
  bank_details jsonb DEFAULT '{}'::jsonb,
  bill_drive_link character varying,
  invoice_drive_link character varying,
  receipt_drive_link character varying,
  supporting_docs jsonb DEFAULT '{}'::jsonb,
  status character varying CHECK (status::text = ANY (ARRAY['draft'::character varying::text, 'submitted'::character varying::text, 'pending'::character varying::text, 'accepted'::character varying::text, 'approved'::character varying::text, 'rejected'::character varying::text, 'reimbursed'::character varying::text, 'paid'::character varying::text])),
  submitted_by uuid,
  submitted_date date,
  reviewed_by uuid,
  reviewed_date date,
  approved_by uuid,
  approved_date date,
  rejection_reason text,
  reimbursed_date date,
  account_code character varying,
  gl_code character varying,
  cost_center character varying,
  is_reimbursable boolean DEFAULT true,
  reimbursed_to character varying,
  approval_chain jsonb DEFAULT '{}'::jsonb,
  current_approver uuid,
  priority character varying,
  tags ARRAY,
  notes text,
  internal_notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  csr_partner_id uuid,
  toll_id uuid,
  budget_category_id uuid,
  CONSTRAINT project_expenses_pkey PRIMARY KEY (id),
  CONSTRAINT project_expenses_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT project_expenses_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.expense_categories(id),
  CONSTRAINT project_expenses_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.tasks(id),
  CONSTRAINT project_expenses_submitted_by_fkey FOREIGN KEY (submitted_by) REFERENCES public.users(id),
  CONSTRAINT project_expenses_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(id),
  CONSTRAINT project_expenses_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT project_expenses_current_approver_fkey FOREIGN KEY (current_approver) REFERENCES public.users(id),
  CONSTRAINT project_expenses_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT project_expenses_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT project_expenses_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id),
  CONSTRAINT project_expenses_toll_id_fkey FOREIGN KEY (toll_id) REFERENCES public.csr_partner_tolls(id),
  CONSTRAINT project_expenses_budget_category_id_fkey FOREIGN KEY (budget_category_id) REFERENCES public.budget_categories(id)
);
CREATE TABLE public.project_team_members (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid NOT NULL,
  user_id uuid NOT NULL,
  role character varying,
  designation character varying,
  responsibilities text,
  is_lead boolean DEFAULT false,
  can_approve_expenses boolean DEFAULT false,
  can_assign_tasks boolean DEFAULT false,
  access_level character varying CHECK (access_level::text = ANY (ARRAY['full'::character varying, 'limited'::character varying, 'view_only'::character varying]::text[])),
  is_active boolean DEFAULT true,
  notes text,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  roles ARRAY DEFAULT ARRAY['team_member'::text],
  CONSTRAINT project_team_members_pkey PRIMARY KEY (id),
  CONSTRAINT project_team_members_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT project_team_members_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT project_team_members_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT project_team_members_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.projects (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  description text,
  csr_partner_id uuid NOT NULL,
  project_manager_id uuid,
  assistant_manager_id uuid,
  location character varying,
  state character varying,
  district character varying,
  city character varying,
  block character varying,
  village character varying,
  pincode character varying,
  latitude numeric,
  longitude numeric,
  category character varying,
  sub_category character varying,
  project_type character varying CHECK (project_type::text = ANY (ARRAY['one_time'::character varying, 'ongoing'::character varying, 'recurring'::character varying]::text[])),
  focus_area ARRAY,
  status character varying CHECK (status::text = ANY (ARRAY['planning'::character varying, 'active'::character varying, 'on_hold'::character varying, 'completed'::character varying, 'cancelled'::character varying, 'archived'::character varying]::text[])),
  start_date date,
  expected_end_date date,
  actual_end_date date,
  duration_months integer,
  total_budget numeric DEFAULT 0,
  approved_budget numeric DEFAULT 0,
  utilized_budget numeric DEFAULT 0,
  pending_budget numeric DEFAULT 0,
  total_beneficiaries integer DEFAULT 0,
  direct_beneficiaries integer DEFAULT 0,
  indirect_beneficiaries integer DEFAULT 0,
  male_beneficiaries integer DEFAULT 0,
  female_beneficiaries integer DEFAULT 0,
  children_beneficiaries integer DEFAULT 0,
  beneficiaries_reached integer DEFAULT 0,
  targets jsonb DEFAULT '{}'::jsonb,
  achievements jsonb DEFAULT '{}'::jsonb,
  completion_percentage integer DEFAULT 0,
  milestones_completed integer DEFAULT 0,
  total_milestones integer DEFAULT 0,
  proposal_drive_link character varying,
  approval_letter_drive_link character varying,
  budget_sheet_drive_link character varying,
  mou_drive_link character varying,
  project_plan_drive_link character varying,
  documents_folder_link character varying,
  is_active boolean DEFAULT true,
  tags ARRAY,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  display_color character varying DEFAULT 'emerald'::character varying,
  display_icon character varying DEFAULT 'FolderKanban'::character varying,
  toll_id uuid,
  impact_metrics jsonb DEFAULT '[]'::jsonb,
  work character varying,
  parent_project_id uuid,
  is_beneficiary_project boolean DEFAULT false,
  beneficiary_number integer,
  pads_distributed integer DEFAULT 0,
  trees_planted integer DEFAULT 0,
  meals_served integer DEFAULT 0,
  students_enrolled integer DEFAULT 0,
  schools_renovated integer DEFAULT 0,
  beneficiary_type character varying,
  beneficiary_name character varying,
  uc_link text,
  CONSTRAINT projects_pkey PRIMARY KEY (id),
  CONSTRAINT projects_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id),
  CONSTRAINT projects_project_manager_id_fkey FOREIGN KEY (project_manager_id) REFERENCES public.users(id),
  CONSTRAINT projects_assistant_manager_id_fkey FOREIGN KEY (assistant_manager_id) REFERENCES public.users(id),
  CONSTRAINT projects_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT projects_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT projects_toll_id_fkey FOREIGN KEY (toll_id) REFERENCES public.csr_partner_tolls(id),
  CONSTRAINT projects_parent_project_id_fkey FOREIGN KEY (parent_project_id) REFERENCES public.projects(id)
);
CREATE TABLE public.real_time_updates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  update_code character varying NOT NULL UNIQUE,
  project_id uuid NOT NULL,
  task_id uuid,
  timeline_id uuid,
  title character varying,
  description text,
  update_type character varying CHECK (update_type::text = ANY (ARRAY['Progress'::character varying, 'Issue'::character varying, 'Achievement'::character varying, 'Milestone'::character varying]::text[])),
  category character varying,
  update_number integer,
  document_number character varying,
  reference_number character varying,
  date date,
  time time without time zone,
  location_name character varying,
  school_name character varying,
  institution_name character varying,
  address text,
  city character varying,
  state character varying,
  latitude numeric,
  longitude numeric,
  images jsonb DEFAULT '{}'::jsonb,
  videos jsonb DEFAULT '{}'::jsonb,
  documents jsonb DEFAULT '{}'::jsonb,
  participants ARRAY,
  beneficiaries_count integer DEFAULT 0,
  attendees_count integer DEFAULT 0,
  impact_data jsonb DEFAULT '{}'::jsonb,
  metrics jsonb DEFAULT '{}'::jsonb,
  is_public boolean DEFAULT true,
  is_featured boolean DEFAULT false,
  is_sent_to_client boolean DEFAULT false,
  sent_date date,
  format_type character varying,
  tags ARRAY,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT real_time_updates_pkey PRIMARY KEY (id),
  CONSTRAINT real_time_updates_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT real_time_updates_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.tasks(id),
  CONSTRAINT real_time_updates_timeline_id_fkey FOREIGN KEY (timeline_id) REFERENCES public.timelines(id),
  CONSTRAINT real_time_updates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT real_time_updates_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.receipt_views (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id text NOT NULL,
  expense_id uuid NOT NULL,
  viewed_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT receipt_views_pkey PRIMARY KEY (id),
  CONSTRAINT receipt_views_expense_id_fkey FOREIGN KEY (expense_id) REFERENCES public.project_expenses(id)
);
CREATE TABLE public.reports (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  report_code character varying NOT NULL UNIQUE,
  project_id uuid,
  title character varying NOT NULL,
  report_type character varying CHECK (report_type::text = ANY (ARRAY['Project'::character varying, 'Daily'::character varying, 'Monthly'::character varying, 'Quarterly'::character varying, 'Annual'::character varying, 'Impact'::character varying, 'Financial'::character varying]::text[])),
  category character varying,
  description text,
  summary text,
  period_from date,
  period_to date,
  fiscal_year character varying,
  report_drive_link character varying,
  presentation_drive_link character varying,
  annexures_drive_link character varying,
  status character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'in_review'::character varying, 'submitted'::character varying, 'approved'::character varying, 'rejected'::character varying]::text[])),
  generated_by uuid,
  reviewed_by uuid,
  approved_by uuid,
  generated_date date,
  submitted_date date,
  approved_date date,
  data jsonb DEFAULT '{}'::jsonb,
  charts jsonb DEFAULT '{}'::jsonb,
  metrics jsonb DEFAULT '{}'::jsonb,
  is_public boolean DEFAULT false,
  is_sent_to_client boolean DEFAULT false,
  sent_date date,
  version character varying,
  parent_report_id uuid,
  tags ARRAY,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT reports_pkey PRIMARY KEY (id),
  CONSTRAINT reports_generated_by_fkey FOREIGN KEY (generated_by) REFERENCES public.users(id),
  CONSTRAINT reports_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(id),
  CONSTRAINT reports_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT reports_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT reports_parent_report_id_fkey FOREIGN KEY (parent_report_id) REFERENCES public.reports(id),
  CONSTRAINT reports_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT reports_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.student_answer_sheets (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  sheet_code character varying NOT NULL UNIQUE,
  question_paper_id uuid NOT NULL,
  project_id_old text,
  student_name character varying NOT NULL,
  student_roll_number character varying,
  student_class character varying,
  school_name character varying,
  campaign_type character varying CHECK (campaign_type::text = ANY (ARRAY['pre'::character varying::text, 'post'::character varying::text])),
  upload_drive_link character varying,
  upload_file_name character varying,
  upload_file_size_mb numeric DEFAULT 0,
  answers jsonb DEFAULT '[]'::jsonb,
  total_questions_attempted integer DEFAULT 0,
  score numeric DEFAULT 0,
  total_marks numeric DEFAULT 0,
  percentage numeric DEFAULT 0,
  grade character varying,
  extraction_status character varying CHECK (extraction_status::text = ANY (ARRAY['pending'::character varying::text, 'processing'::character varying::text, 'completed'::character varying::text, 'failed'::character varying::text])),
  extraction_error text,
  grading_status character varying CHECK (grading_status::text = ANY (ARRAY['pending'::character varying::text, 'processing'::character varying::text, 'completed'::character varying::text, 'failed'::character varying::text])),
  grading_error text,
  is_verified boolean DEFAULT false,
  verified_by uuid,
  verified_at timestamp with time zone,
  processing_time_seconds integer DEFAULT 0,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  project_id uuid,
  csr_partner_id uuid,
  CONSTRAINT student_answer_sheets_pkey PRIMARY KEY (id),
  CONSTRAINT student_answer_sheets_question_paper_id_fkey FOREIGN KEY (question_paper_id) REFERENCES public.campaign_question_papers(id),
  CONSTRAINT student_answer_sheets_verified_by_fkey FOREIGN KEY (verified_by) REFERENCES public.users(id),
  CONSTRAINT student_answer_sheets_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT student_answer_sheets_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT student_answer_sheets_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT student_answer_sheets_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id)
);
CREATE TABLE public.system_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  log_level character varying CHECK (log_level::text = ANY (ARRAY['INFO'::character varying, 'WARNING'::character varying, 'ERROR'::character varying, 'CRITICAL'::character varying]::text[])),
  module character varying,
  message text,
  error_code character varying,
  stack_trace text,
  context jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT system_logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.task_time_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  task_id uuid NOT NULL,
  user_id uuid NOT NULL,
  start_time timestamp with time zone,
  end_time timestamp with time zone,
  duration_minutes integer DEFAULT 0,
  description text,
  is_billable boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT task_time_logs_pkey PRIMARY KEY (id),
  CONSTRAINT task_time_logs_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.tasks(id),
  CONSTRAINT task_time_logs_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id)
);
CREATE TABLE public.task_views (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id text NOT NULL,
  task_id uuid NOT NULL,
  viewed_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT task_views_pkey PRIMARY KEY (id),
  CONSTRAINT task_views_task_id_fkey FOREIGN KEY (task_id) REFERENCES public.tasks(id)
);
CREATE TABLE public.tasks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  task_code character varying NOT NULL UNIQUE,
  project_id uuid NOT NULL,
  timeline_id uuid,
  parent_task_id uuid,
  title character varying NOT NULL,
  description text,
  task_type character varying CHECK (task_type::text = ANY (ARRAY['Development'::character varying, 'Research'::character varying, 'Meeting'::character varying, 'Review'::character varying, 'Distribution'::character varying, 'Event'::character varying, 'Infrastructure'::character varying, 'Education'::character varying, 'Logistics'::character varying, 'Finance'::character varying]::text[])),
  category character varying,
  assigned_to uuid NOT NULL,
  assigned_by uuid,
  department character varying,
  due_date date,
  start_date date,
  completed_date date,
  status character varying CHECK (status::text = ANY (ARRAY['not_started'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'on_priority'::character varying, 'blocked'::character varying, 'cancelled'::character varying]::text[])),
  priority character varying,
  completion_percentage integer DEFAULT 0,
  actual_hours integer DEFAULT 0,
  tags ARRAY,
  dependencies ARRAY,
  is_visible_to_client boolean DEFAULT false,
  is_from_client_timeline boolean DEFAULT false,
  is_active boolean DEFAULT true,
  checklist jsonb DEFAULT '{}'::jsonb,
  attachments jsonb DEFAULT '{}'::jsonb,
  comments_count integer DEFAULT 0,
  updates_count integer DEFAULT 0,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  toll_id uuid,
  CONSTRAINT tasks_pkey PRIMARY KEY (id),
  CONSTRAINT tasks_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.users(id),
  CONSTRAINT tasks_assigned_by_fkey FOREIGN KEY (assigned_by) REFERENCES public.users(id),
  CONSTRAINT tasks_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT tasks_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT tasks_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT tasks_timeline_id_fkey FOREIGN KEY (timeline_id) REFERENCES public.timelines(id),
  CONSTRAINT tasks_parent_task_id_fkey FOREIGN KEY (parent_task_id) REFERENCES public.tasks(id),
  CONSTRAINT tasks_toll_id_fkey FOREIGN KEY (toll_id) REFERENCES public.csr_partner_tolls(id)
);
CREATE TABLE public.timelines (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid NOT NULL,
  parent_id uuid,
  milestone_code character varying NOT NULL UNIQUE,
  title character varying NOT NULL,
  description text,
  category character varying CHECK (category::text = ANY (ARRAY['Planning'::character varying, 'Execution'::character varying, 'Monitoring'::character varying, 'Closure'::character varying]::text[])),
  start_date date,
  end_date date,
  actual_start_date date,
  actual_end_date date,
  duration_days integer,
  status character varying CHECK (status::text = ANY (ARRAY['not_started'::character varying, 'in_progress'::character varying, 'completed'::character varying, 'on_priority'::character varying, 'blocked'::character varying, 'cancelled'::character varying]::text[])),
  completion_percentage integer DEFAULT 0,
  order_index integer,
  priority character varying,
  is_critical_path boolean DEFAULT false,
  dependencies ARRAY,
  deliverables ARRAY,
  success_criteria ARRAY,
  responsible_user_id uuid,
  approved_by uuid,
  approval_date date,
  attachments jsonb DEFAULT '{}'::jsonb,
  notes text,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT timelines_pkey PRIMARY KEY (id),
  CONSTRAINT timelines_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT timelines_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.timelines(id),
  CONSTRAINT timelines_responsible_user_id_fkey FOREIGN KEY (responsible_user_id) REFERENCES public.users(id),
  CONSTRAINT timelines_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT timelines_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT timelines_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id)
);
CREATE TABLE public.users (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  auth_id uuid UNIQUE,
  email character varying NOT NULL UNIQUE,
  full_name character varying NOT NULL,
  mobile_number character varying,
  address text,
  city character varying,
  state character varying,
  pincode character varying,
  role character varying NOT NULL CHECK (role::text = ANY (ARRAY['admin'::character varying::text, 'accountant'::character varying::text, 'project_manager'::character varying::text, 'team_member'::character varying::text, 'client'::character varying::text, 'data_manager'::character varying::text])),
  department character varying,
  team character varying,
  designation character varying,
  manager_id uuid,
  reporting_to character varying,
  cosmetic_employee_id character varying UNIQUE,
  is_active boolean DEFAULT true,
  last_login_at timestamp with time zone,
  preferences jsonb DEFAULT '{}'::jsonb,
  permissions jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  username character varying UNIQUE,
  password character varying,
  csr_partner_id uuid,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_auth_id_fkey FOREIGN KEY (auth_id) REFERENCES auth.users(id),
  CONSTRAINT users_manager_id_fkey FOREIGN KEY (manager_id) REFERENCES public.users(id),
  CONSTRAINT users_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT users_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT users_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id)
);
CREATE TABLE public.utilization_certificates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  certificate_code character varying NOT NULL UNIQUE,
  project_id uuid NOT NULL,
  csr_partner_id uuid NOT NULL,
  certificate_heading character varying,
  certificate_type character varying CHECK (certificate_type::text = ANY (ARRAY['Quarterly'::character varying::text, 'Half-Yearly'::character varying::text, 'Annual'::character varying::text, 'Project Completion'::character varying::text, 'Project-Specific'::character varying::text])),
  period_from date,
  period_to date,
  fiscal_year character varying,
  total_amount numeric DEFAULT 0,
  utilized_amount numeric DEFAULT 0,
  certificate_drive_link character varying,
  annexure_drive_link character varying,
  supporting_docs jsonb DEFAULT '{}'::jsonb,
  format_type character varying,
  issue_date date,
  prepared_by uuid,
  reviewed_by uuid,
  approved_by uuid,
  status character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'pending'::character varying, 'approved'::character varying]::text[])),
  sent_to_partner boolean DEFAULT false,
  sent_date date,
  acknowledged boolean DEFAULT false,
  acknowledgment_date date,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  updated_by uuid,
  certificate_bucket_path character varying,
  certificate_file_name character varying,
  certificate_file_size_mb numeric DEFAULT 0,
  certificate_file_type character varying,
  annexure_bucket_path character varying,
  annexure_file_name character varying,
  annexure_file_size_mb numeric DEFAULT 0,
  annexure_file_type character varying,
  supporting_files jsonb DEFAULT '[]'::jsonb,
  uploaded_by uuid,
  file_upload_date timestamp with time zone,
  CONSTRAINT utilization_certificates_pkey PRIMARY KEY (id),
  CONSTRAINT utilization_certificates_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(id),
  CONSTRAINT utilization_certificates_csr_partner_id_fkey FOREIGN KEY (csr_partner_id) REFERENCES public.csr_partners(id),
  CONSTRAINT utilization_certificates_prepared_by_fkey FOREIGN KEY (prepared_by) REFERENCES public.users(id),
  CONSTRAINT utilization_certificates_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.users(id),
  CONSTRAINT utilization_certificates_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.users(id),
  CONSTRAINT utilization_certificates_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.users(id),
  CONSTRAINT utilization_certificates_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.users(id),
  CONSTRAINT utilization_certificates_uploaded_by_fkey FOREIGN KEY (uploaded_by) REFERENCES public.users(id)
);
CREATE TABLE public.whatsapp_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL UNIQUE,
  message text NOT NULL,
  category character varying,
  variables jsonb DEFAULT '{}'::jsonb,
  media_url character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT whatsapp_templates_pkey PRIMARY KEY (id)
);